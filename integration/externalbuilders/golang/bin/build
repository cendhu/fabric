#!/bin/bash

# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0

set -euo pipefail

if [ "$#" -ne 3 ]; then
    echo "Expected 3 directories got $#"
    exit 1
fi

SOURCE=$1
GO_PACKAGE_PATH=$(jq -r .path $2/metadata.json)
OUTPUT=$3

if [ -f "$SOURCE/src/go.mod" ]; then
    cd $SOURCE/src
    GO111MODULE=on GOPROXY=https://proxy.golang.org go build -v -mod=readonly -o "$OUTPUT/chaincode" $GO_PACKAGE_PATH
else
    exit 1
fi
