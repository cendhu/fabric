#!/bin/bash

# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0

set -euo pipefail

if [ "$#" -ne 3 ]; then
    echo "Expected 3 directories got $#"
    exit 1
fi

SOURCE=$1
GO_PACKAGE_PATH="$(grep -o '"Path": *"[^"]*"' "$2/metadata.json"| grep -o '"[^"]*"$')"
OUTPUT=$3

GOPATH=$SOURCE:$GOPATH go build -o "$OUTPUT/chaincode" -ldflags "-linkmode external -extldflags '-static'" $GO_PACKAGE_PATH
